<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>♠️ Black Jack Online ♥️</title>
  <style>
    body {
      background-color: #001a00;
      color: white;
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .container {
      background-color: #142814;
      border-radius: 20px;
      padding: 30px;
      max-width: 600px;
      text-align: center;
    }
    h1 {
      color: #FFD700;
      font-size: 40px;
    }
    .card-box, .dealer-box {
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .card-box { background-color: #004d00; }
    .dealer-box { background-color: #333333; }
    .points {
      color: #FFD700;
      font-size: 22px;
      margin-bottom: 20px;
    }
    button {
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      margin: 5px;
    }
    #deal { background-color: #228B22; }
    #hit { background-color: #0066CC; }
    #stand { background-color: #CC0000; }
    #resetPoints { background-color: #FF8C00; }
    #leaderboardBtn { background-color: #4444AA; }

    /* Login/Register */
    #loginScreen {
      text-align: center;
    }
    input {
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      margin: 8px;
      width: 70%;
    }
  </style>
</head>
<body>
  <div class="container" id="loginScreen">
    <h1>♠️ Black Jack Online ♥️</h1>
    <h2>🔐 Anmelden oder Registrieren</h2>
    <input type="text" id="username" placeholder="Benutzername">
    <br>
    <button id="loginBtn">Anmelden / Registrieren</button>
    <p style="font-size:14px;color:#ccc;">Deine Punkte werden lokal im Browser gespeichert.</p>
  </div>

  <div class="container" id="gameScreen" style="display:none;">
    <h1>♠️ Black Jack Online ♥️</h1>
    <p id="welcomeUser"></p>
    <p id="message">🎲 Drücke 'Deal', um zu starten!</p>

    <div class="card-box" id="player-box">🧍 Spieler: -</div>
    <div class="dealer-box" id="dealer-box" style="display: none;">🤖 Dealer:</div>

    <div class="points" id="points">💰 Punkte: 100</div>

    <div>
      <button id="deal">Deal</button>
      <button id="hit">Hit</button>
      <button id="stand">Stand</button>
    </div>
    <div style="margin-top:15px;">
      <button id="resetPoints">🔄 Punkte zurücksetzen</button>
      <button id="leaderboardBtn">🏆 Bestenliste</button>
      <button id="logoutBtn">🚪 Abmelden</button>
    </div>
  </div>

  <div class="container" id="leaderboardScreen" style="display:none;">
    <h1>🏆 Bestenliste</h1>
    <div id="leaderboard"></div>
    <button id="backToGame">⬅️ Zurück</button>
  </div>

  <script>
    // --- Globale Variablen ---
    let playerHand = [];
    let dealerHand = [];
    let message = document.getElementById("message");
    let dealerBox = document.getElementById("dealer-box");
    let playerBox = document.getElementById("player-box");
    let pointsBox = document.getElementById("points");
    let currentUser = null;
    let points = 100;
    let standBlocked = false;

    const fullDeck = [
      2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,
      8,8,8,8,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11
    ];
    let cards = [...fullDeck];

    // --- Login/Registrierung ---
    document.getElementById("loginBtn").onclick = function() {
      const username = document.getElementById("username").value.trim();
      if (!username) return alert("Bitte gib einen Benutzernamen ein!");

      let users = JSON.parse(localStorage.getItem("blackjackUsers") || "{}");
      if (!users[username]) {
        users[username] = { points: 100 };
      }

      localStorage.setItem("blackjackUsers", JSON.stringify(users));
      currentUser = username;
      points = users[username].points;
      showGameScreen();
    };

    function showGameScreen() {
      document.getElementById("loginScreen").style.display = "none";
      document.getElementById("leaderboardScreen").style.display = "none";
      document.getElementById("gameScreen").style.display = "block";
      document.getElementById("welcomeUser").textContent = `👋 Willkommen, ${currentUser}!`;
      updateUI();
    }

    document.getElementById("logoutBtn").onclick = function() {
      currentUser = null;
      document.getElementById("gameScreen").style.display = "none";
      document.getElementById("loginScreen").style.display = "block";
    };

    // --- Spielmechanik ---
    function drawCard() {
      const index = Math.floor(Math.random() * cards.length);
      const card = cards[index];
      cards.splice(index, 1);
      return card;
    }

    function sum(hand) {
      return hand.reduce((a, b) => a + b, 0);
    }

    function updateUI() {
      playerBox.textContent = `🧍 Spieler: ${playerHand.join(", ")} (Summe: ${sum(playerHand) || 0})`;
      pointsBox.textContent = `💰 Punkte: ${points}`;
      savePoints();
    }

    function savePoints() {
      let users = JSON.parse(localStorage.getItem("blackjackUsers") || "{}");
      if (currentUser && users[currentUser]) {
        users[currentUser].points = points;
        localStorage.setItem("blackjackUsers", JSON.stringify(users));
      }
    }

    document.getElementById("deal").onclick = function() {
      if (points < 10) {
        message.textContent = "🤑 Du bist pleite. Punkte zurücksetzen oder neu starten!";
        return;
      }
      standBlocked = false;
      points -= 10;
      cards = [...fullDeck];
      playerHand = [drawCard(), drawCard()];
      dealerHand = [drawCard(), drawCard()];
      dealerBox.style.display = "none";
      message.textContent = "Neue Runde! 🍀 Viel Glück!";
      updateUI();
    };

    document.getElementById("hit").onclick = function() {
      playerHand.push(drawCard());
      updateUI();
      if (sum(playerHand) > 21) message.textContent = "💥 Bust! Du hast verloren.";
    };

    document.getElementById("stand").onclick = function() {
      if (standBlocked) return;
      standBlocked = true;
      while (sum(dealerHand) < 17) dealerHand.push(drawCard());

      const playerScore = sum(playerHand);
      const dealerScore = sum(dealerHand);
      let result;

      if (dealerScore > 21) result = "🏆 Dealer bust! Du gewinnst!";
      else if (playerScore > 21) result = "💥 Bust! Du hast verloren.";
      else if (playerScore > dealerScore) result = "🎉 Du gewinnst!";
      else if (playerScore < dealerScore) result = "❌ Dealer gewinnt.";
      else result = "🤝 Unentschieden!";

      message.textContent = result;

      if (playerScore <= 21) {
        if (dealerScore > 21 || playerScore > dealerScore) points += 20;
        else if (playerScore === dealerScore) points += 10;
      }

      dealerBox.textContent = `🤖 Dealer: ${dealerHand.join(", ")} (Summe: ${dealerScore})`;
      dealerBox.style.display = "block";
      updateUI();
    };

    // --- Punkte zurücksetzen ---
    document.getElementById("resetPoints").onclick = function() {
      if (confirm("Willst du deine Punkte wirklich auf 100 zurücksetzen?")) {
        points = 100;
        updateUI();
      }
    };

    // --- Bestenliste ---
    document.getElementById("leaderboardBtn").onclick = function() {
      document.getElementById("gameScreen").style.display = "none";
      document.getElementById("leaderboardScreen").style.display = "block";
      showLeaderboard();
    };

    document.getElementById("backToGame").onclick = showGameScreen;

    function showLeaderboard() {
      const users = JSON.parse(localStorage.getItem("blackjackUsers") || "{}");
      const sorted = Object.entries(users)
        .sort((a, b) => b[1].points - a[1].points);

      let html = "<ol style='text-align:left;'>";
      sorted.forEach(([name, data]) => {
        html += `<li>${name} — <b>${data.points} Punkte</b></li>`;
      });
      html += "</ol>";
      document.getElementById("leaderboard").innerHTML = html;
    }
  </script>
</body>
</html>
