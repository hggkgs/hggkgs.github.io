<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‚ô†Ô∏è Black Jack Online ‚ô•Ô∏è ‚Äî Hobbyprojekt</title>
  <style>
    :root{
      --bg:#001a00;
      --panel:#142814;
      --accent:#FFD700;
      --muted:#aaa;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:var(--bg);
      color:#fff;
      font-family:Arial,Helvetica,sans-serif;
      padding:20px;
    }
    .container{
      width:100%;
      max-width:720px;
      background:var(--panel);
      border-radius:18px;
      padding:22px;
      text-align:center;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
    }
    h1{ color:var(--accent); margin:6px 0 10px; font-size:34px;}
    .card-box, .dealer-box{
      border-radius:12px;
      padding:14px;
      margin:10px 0;
      text-align:left;
    }
    .card-box{ background:#004d00 }
    .dealer-box{ background:#333333 }
    .points{ color:var(--accent); font-size:20px; margin:10px 0 16px;}
    input[type="text"]{
      width:70%;
      padding:10px;
      border-radius:8px;
      border:none;
      margin:6px 0;
      font-size:16px;
    }
    button{
      padding:10px 16px;
      margin:6px;
      font-size:15px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      color:#fff;
    }
    #deal{ background:#228B22 }
    #hit{ background:#0066CC }
    #stand{ background:#CC0000 }
    #resetPoints{ background:#FF8C00 }
    #leaderboardBtn{ background:#4444AA }
    #deleteAccount{ background:#882222 }
    .small{ font-size:13px; color:var(--muted) }
    footer{ margin-top:12px; font-size:13px; color:var(--muted) }

    /* Modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.6);
      display:none;
      align-items:center;
      justify-content:center;
      padding:20px;
      z-index:50;
    }
    .modal{
      background:#0f2610;
      border-radius:12px;
      padding:18px;
      width:100%;
      max-width:720px;
      color:#eee;
      text-align:left;
      max-height:90vh;
      overflow:auto;
    }
    .modal h3{ margin-top:0; color:var(--accent) }
    .row{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-top:10px; }

    /* Leaderboard list */
    ol.leader{
      text-align:left;
      padding-left:20px;
      color:#fff;
    }
    .tag{
      display:inline-block;
      font-size:12px;
      padding:2px 8px;
      border-radius:12px;
      background:#2b2b2b;
      margin-left:8px;
    }
    @media(max-width:520px){
      input[type="text"]{ width:100% }
      .row{ flex-direction:column }
    }
  </style>
</head>
<body>

  <!-- LOGIN -->
  <div class="container" id="loginScreen">
    <h1>‚ô†Ô∏è Black Jack Online ‚ô•Ô∏è</h1>
    <p class="small">Dieses Projekt ist ein **privates Hobbyprojekt** ‚Äî keine echten Eins√§tze oder Gewinne m√∂glich.</p>

    <h3 style="color:#000">üîê Anmelden / Registrieren</h3>
    <input id="username" placeholder="Benutzername (frei w√§hlbar, lokal gespeichert)">
    <div class="row">
      <button id="loginBtn">Anmelden / Registrieren</button>
      <button id="openImpressum">Impressum & Datenschutz</button>
    </div>

    <p class="small" style="margin-top:12px;">
      Hinweis: Benutzername & Punkte werden **nur lokal im Browser (localStorage)** gespeichert. Es findet **keine √úbertragung** an Drittanbieter statt.
    </p>
  </div>

  <!-- SPIEL -->
  <div class="container" id="gameScreen" style="display:none;">
    <h1>‚ô†Ô∏è Black Jack Online ‚ô•Ô∏è</h1>
    <p id="welcomeUser" style="font-size:16px;color:var(--accent)"></p>
    <p id="message">üé≤ Dr√ºcke 'Deal', um zu starten!</p>

    <div class="card-box" id="player-box">üßç Spieler: -</div>
    <div class="dealer-box" id="dealer-box" style="display:none">ü§ñ Dealer:</div>

    <div class="points" id="points">üí∞ Punkte: 100</div>

    <div class="row" style="justify-content:center">
      <button id="deal">Deal</button>
      <button id="hit">Hit</button>
      <button id="stand">Stand</button>
    </div>

    <div class="row" style="margin-top:8px">
      <button id="resetPoints">üîÑ Punkte auf 100 zur√ºcksetzen</button>
      <button id="leaderboardBtn">üèÜ Bestenliste</button>
      <button id="deleteAccount">üóëÔ∏è Konto l√∂schen</button>
      <button id="logoutBtn">üö™ Abmelden</button>
    </div>

    <p class="small" style="margin-top:10px;">
      Keine echten Eins√§tze oder Preise. Nur Unterhaltung. Betreiber: Privates Hobbyprojekt.
    </p>
  </div>

  <!-- LEADERBOARD -->
  <div class="container" id="leaderboardScreen" style="display:none;">
    <h1>üèÜ Bestenliste</h1>
    <div id="leaderboard"></div>
    <div class="row" style="margin-top:12px">
      <button id="backToGame">‚¨ÖÔ∏è Zur√ºck</button>
      <button id="openImpressum2">Impressum & Datenschutz</button>
    </div>
  </div>

  <!-- MODAL: Impressum & Datenschutz -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-hidden="true">
    <div class="modal" role="document">
      <h3>Impressum & Datenschutz</h3>

      <h4>Impressum</h4>
      <p style="margin-top:6px;">
        Betreiber: Privates Hobbyprojekt<br>
        Kontakt: <span class="small">keine √∂ffentliche Kontaktadresse</span><br>
        Nutzung: rein privat, nicht kommerziell.
      </p>

      <h4>Rechtlicher Hinweis</h4>
      <p>
        Dieses Spiel ist ein **reines Unterhaltungsprojekt**. Es werden **keine echten Eins√§tze** akzeptiert und **keine echten Gewinne** ausgezahlt. Es handelt sich nicht um ein Gl√ºcksspielangebot im Sinne einer Gewinnchance f√ºr finanzielle Vorteile.
      </p>

      <h4>Datenschutz (kurz)</h4>
      <ul>
        <li>Es werden nur folgende Daten lokal im Browser gespeichert: <b>Benutzername</b> und <b>Punktestand</b>, gespeichert √ºber <code>localStorage</code>.</li>
        <li>Es findet <b>keine √úbermittlung</b> deiner Daten an externe Server oder Drittanbieter statt (sofern du nicht selbst zus√§tzliche Dienste einbindest).</li>
        <li>Du kannst dein Konto jederzeit l√∂schen (Button: "Konto l√∂schen") ‚Äî damit werden Benutzername und Punkte lokal entfernt.</li>
        <li>Wenn du die Seite im Browser l√∂schst/Cache/Cookies reinigst, sind die Daten ebenfalls verloren.</li>
      </ul>

      <h4>Weitere Hinweise</h4>
      <p class="small">
        Wenn du planst, die Seite √∂ffentlich oder kommerziell zu betreiben oder wenn du externe Dienste (z. B. Firebase) integrierst, sollten Impressum, Datenschutzerkl√§rung und ggf. Einwilligungen angepasst werden. Diese Seite ist f√ºr rein private / schulische / Hobby-Zwecke vorbereitet.
      </p>

      <div style="text-align:center; margin-top:12px;">
        <button id="closeModal">Schlie√üen</button>
      </div>
    </div>
  </div>

  <footer style="text-align:center; width:100%; max-width:720px; margin-top:12px;">
    <p class="small">¬© Privates Hobbyprojekt ‚Äî kein Echtgeld ¬∑ <button id="openImpressumFooter" style="background:transparent;border:0;color:var(--muted);cursor:pointer">Impressum & Datenschutz</button></p>
  </footer>

  <script>
    // --- Grundlogik / Spielvariablen ---
    let playerHand = [];
    let dealerHand = [];
    let points = 100;
    let currentUser = null;
    let standBlocked = false;

    const fullDeck = [
      2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,6,6,6,6,7,7,7,7,
      8,8,8,8,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11
    ];
    let cards = [...fullDeck];

    // --- Helper ---
    function saveUsersToStorage(users){
      localStorage.setItem("blackjackUsers", JSON.stringify(users));
    }
    function loadUsersFromStorage(){
      return JSON.parse(localStorage.getItem("blackjackUsers") || "{}");
    }

    function drawCard(){
      if(cards.length === 0) cards = [...fullDeck];
      const idx = Math.floor(Math.random() * cards.length);
      const c = cards[idx];
      cards.splice(idx,1);
      return c;
    }
    function sum(hand){ return hand.reduce((a,b)=>a+b,0); }

    // --- UI Elemente ---
    const loginScreen = document.getElementById("loginScreen");
    const gameScreen = document.getElementById("gameScreen");
    const leaderboardScreen = document.getElementById("leaderboardScreen");
    const message = document.getElementById("message");
    const dealerBox = document.getElementById("dealer-box");
    const playerBox = document.getElementById("player-box");
    const pointsBox = document.getElementById("points");
    const welcomeUser = document.getElementById("welcomeUser");

    // --- Login/Register ---
    document.getElementById("loginBtn").onclick = function(){
      const usernameInput = document.getElementById("username");
      const username = usernameInput.value.trim();
      if(!username){
        alert("Bitte gib einen Benutzernamen ein.");
        return;
      }
      // Sanitize: nur einfache Zeichen (keine HTML) ‚Äî wir store plain string
      const safeName = username.replace(/</g,"&lt;").replace(/>/g,"&gt;").slice(0,30);

      let users = loadUsersFromStorage();
      if(!users[safeName]){
        users[safeName] = { points: 100 };
      }
      saveUsersToStorage(users);

      currentUser = safeName;
      points = users[safeName].points;
      showGameScreen();
    };

    function showGameScreen(){
      loginScreen.style.display = "none";
      leaderboardScreen.style.display = "none";
      gameScreen.style.display = "block";
      welcomeUser.textContent = `üëã Willkommen, ${currentUser} ‚Äî (Hobbyprojekt)`;
      updateUI();
    }

    document.getElementById("logoutBtn").onclick = function(){
      currentUser = null;
      playerHand = [];
      dealerHand = [];
      gameScreen.style.display = "none";
      loginScreen.style.display = "block";
    };

    // --- Spielaktionen ---
    document.getElementById("deal").onclick = function(){
      if(points < 10){
        message.textContent = "‚ö†Ô∏è Zu wenig Punkte ‚Äî setze deine Punkte zur√ºck oder spiele sp√§ter.";
        return;
      }
      standBlocked = false;
      points -= 10;
      cards = [...fullDeck];
      playerHand = [drawCard(), drawCard()];
      dealerHand = [drawCard(), drawCard()];
      dealerBox.style.display = "none";
      message.textContent = "Neue Runde! üçÄ Viel Gl√ºck!";
      updateUI();
    };

    document.getElementById("hit").onclick = function(){
      if(playerHand.length === 0){
        message.textContent = "Dr√ºcke zuerst Deal.";
        return;
      }
      playerHand.push(drawCard());
      updateUI();
      if(sum(playerHand) > 21) message.textContent = "üí• Bust! Du hast verloren.";
    };

    document.getElementById("stand").onclick = function(){
      if(standBlocked) return;
      if(playerHand.length === 0){
        message.textContent = "Dr√ºcke zuerst Deal.";
        return;
      }
      standBlocked = true;
      while(sum(dealerHand) < 17) dealerHand.push(drawCard());

      const playerScore = sum(playerHand);
      const dealerScore = sum(dealerHand);
      let result;

      if (dealerScore > 21) result = "üèÜ Dealer bust! Du gewinnst!";
      else if (playerScore > 21) result = "üí• Bust! Du hast verloren.";
      else if (playerScore > dealerScore) result = "üéâ Du gewinnst!";
      else if (playerScore < dealerScore) result = "‚ùå Dealer gewinnt.";
      else result = "ü§ù Unentschieden!";

      message.textContent = result;

      if (playerScore <= 21) {
        if (dealerScore > 21 || playerScore > dealerScore) points += 20;
        else if (playerScore === dealerScore) points += 10;
      }

      dealerBox.textContent = `ü§ñ Dealer: ${dealerHand.join(", ")} (Summe: ${dealerScore})`;
      dealerBox.style.display = "block";
      updateUI();
    };

    function updateUI(){
      playerBox.textContent = `üßç Spieler: ${playerHand.join(", ")} (Summe: ${sum(playerHand) || 0})`;
      pointsBox.textContent = `üí∞ Punkte: ${points}`;
      saveCurrentUserPoints();
    }

    function saveCurrentUserPoints(){
      if(!currentUser) return;
      const users = loadUsersFromStorage();
      if(users[currentUser]){
        users[currentUser].points = points;
        saveUsersToStorage(users);
      }
    }

    // --- Punkte zur√ºcksetzen ---
    document.getElementById("resetPoints").onclick = function(){
      if(!currentUser) return;
      if(confirm("M√∂chtest du deine Punkte wirklich auf 100 zur√ºcksetzen?")){
        points = 100;
        updateUI();
        alert("Punkte wurden zur√ºckgesetzt.");
      }
    };

    // --- Bestenliste (ger√§t√ºbergreifend? Hinweis) ---
    document.getElementById("leaderboardBtn").onclick = function(){
      // Hinweis: aktuell lokal -> nur auf diesem Ger√§t sichtbar.
      // Wir zeigen die gesamte localStorage-Liste (alle Benutzer dieses Browsers).
      gameScreen.style.display = "none";
      leaderboardScreen.style.display = "block";
      showLeaderboard();
    };
    document.getElementById("backToGame").onclick = function(){ leaderboardScreen.style.display = "none"; showGameScreen(); };

    function showLeaderboard(){
      const users = loadUsersFromStorage();
      const sorted = Object.entries(users).sort((a,b)=> b[1].points - a[1].points);
      if(sorted.length === 0){
        document.getElementById("leaderboard").innerHTML = "<p class='small'>Keine Eintr√§ge vorhanden.</p>";
        return;
      }
      let html = "<ol class='leader'>";
      sorted.forEach(([name,data],i)=>{
        // kleine Medaillen-Markierung
        let medal = "";
        if(i===0) medal = " <span class='tag'>ü•á</span>";
        else if(i===1) medal = " <span class='tag'>ü•à</span>";
        else if(i===2) medal = " <span class='tag'>ü•â</span>";
        html += `<li><strong>${name}</strong> ‚Äî ${data.points} Punkte${medal}</li>`;
      });
      html += "</ol>";
      html += "<p class='small' style='margin-top:8px;'>Hinweis: Diese Bestenliste ist <b>lokal</b> (nur dieses Ger√§t / Browser). Wenn du ger√§te√ºbergreifende Speicherung m√∂chtest, muss ein Cloud-Dienst (z. B. Firebase) genutzt werden.</p>";
      document.getElementById("leaderboard").innerHTML = html;
    }

    // --- Konto l√∂schen (lokal) ---
    document.getElementById("deleteAccount").onclick = function(){
      if(!currentUser) return;
      if(!confirm("Willst du dein Konto UND deine lokalen Daten (Benutzername + Punkte) vollst√§ndig l√∂schen? Diese Aktion ist nicht r√ºckg√§ngig.")) return;
      let users = loadUsersFromStorage();
      if(users[currentUser]) delete users[currentUser];
      saveUsersToStorage(users);
      alert("Konto wurde lokal gel√∂scht.");
      // Abmelden und zur√ºck zum Login
      currentUser = null;
      playerHand = []; dealerHand = []; points = 100;
      gameScreen.style.display = "none";
      loginScreen.style.display = "block";
    };

    // --- Modal (Impressum & Datenschutz) ---
    const modalBackdrop = document.getElementById("modalBackdrop");
    document.getElementById("openImpressum").onclick = openModal;
    document.getElementById("openImpressumFooter").onclick = openModal;
    document.getElementById("openImpressum2").onclick = openModal;
    document.getElementById("closeModal").onclick = closeModal;

    function openModal(){ modalBackdrop.style.display = "flex"; modalBackdrop.setAttribute("aria-hidden","false"); }
    function closeModal(){ modalBackdrop.style.display = "none"; modalBackdrop.setAttribute("aria-hidden","true"); }
    modalBackdrop.addEventListener("click", (e)=>{ if(e.target === modalBackdrop) closeModal(); });

    // --- Initialisierung: Wenn bereits ein eingeloggter Benutzer (session) existiert -> nicht automatisch einloggen, immer manuell -->
    // (Wir bieten kein session cookie; Nutzer loggt sich neu ein.)
    // Optional: Du k√∂nntest hier sessionStorage pr√ºfen und automatisch einloggen.

    // --- Sicherheitshinweis in UI: Entfernt irref√ºhrende Texte √ºber K√§ufe ---
    // (bereits umgesetzt: kein Hinweis auf kostenpflichtige K√§ufe)

  </script>
</body>
</html>
